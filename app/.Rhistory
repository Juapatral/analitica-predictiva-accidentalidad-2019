acc_gravedad <- acc %>%
group_by(GRAVEDAD) %>%
summarize(total_registros = n())
ggplot(data=acc_gravedad, aes(x=GRAVEDAD, y=total_registros)) +
geom_bar(stat="identity", position="dodge", fill = "blue3", color = "grey48", alpha =
.8)+
xlab("Gravedad del accidente")+ # eje x
ylab("Total registros")+ # eje y
ggtitle("Número de accidentes por gravedad del accidente") #título del gráfico
acc_diseno <- acc %>%
group_by(DISENO) %>%
summarize(total_registros = n())
ggplot(data=acc_diseno, aes(x=DISENO, y=total_registros)) +
geom_bar(stat="identity", position="dodge", fill = "blue3", color = "grey48", alpha =
.8)+
xlab("Diseño de la vía")+ # eje x
ylab("Total registros")+ # eje y
ggtitle("Número de accidentes por tipo de vía")+ #título del gráfico
coord_flip()
acc_group_clase<- acc %>% group_by(GRAVEDAD, CLASE) %>% summarize(conteo = n()) %>% spread(GRAVEDAD, conteo, fill=0)
head(acc_group_clase)
acc_group_clase1<- acc %>% group_by(GRAVEDAD, CLASE) %>% summarize(conteo = n())
ggplot(data=acc_group_clase1, aes(x=GRAVEDAD, y=conteo, fill=CLASE)) +
geom_bar(stat="identity", position="dodge")+
scale_fill_manual(values=c("#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0", "#92c5de","#4393c3","#2166ac", "#053061"))
acc_group_mes<- acc %>% group_by(GRAVEDAD, MES) %>% summarize(conteo = n()) %>% spread(GRAVEDAD, conteo, fill=0)
acc_group_mes1<- acc %>% group_by(GRAVEDAD, MES) %>% summarize(conteo = n())
ggplot(data=acc_group_mes1, aes(x=GRAVEDAD, y=conteo, fill=MES)) +
geom_bar(stat="identity", position="dodge")
#acc_year$PERIODO <- as.numeric(acc_year$PERIODO)
acc_group_year<- acc %>% group_by(GRAVEDAD, PERIODO) %>% summarize(conteo = n()) %>% spread(GRAVEDAD, conteo, fill=0)
acc_group_year1<- acc %>% group_by(GRAVEDAD, PERIODO) %>% summarize(conteo = n())
ggplot(data=acc_group_year1, aes(x=GRAVEDAD, y=conteo, fill=PERIODO)) +
geom_bar(stat="identity", position="dodge")+
scale_fill_manual(values=c("#d0d1e6", "#bdc9e1","#74a9cf","#2b8cbe","#045a8d"))
acc_group_dia<- acc %>% group_by(GRAVEDAD, DIA_NOMBRE) %>% summarize(conteo = n()) %>% spread(GRAVEDAD, conteo, fill=0)
acc_group_dia1<- acc %>% group_by(GRAVEDAD, DIA_NOMBRE) %>% summarize(conteo = n())
ggplot(data=acc_group_dia1, aes(x=GRAVEDAD, y=conteo, fill=DIA_NOMBRE)) +
geom_bar(stat="identity", position="dodge")+
scale_fill_manual(values=c("#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0", "#92c5de"))
acc_fecha <- acc %>%
group_by(FECHA) %>%
summarize(total_registros = n())
plot_ly (data=subset(acc_fecha,subset = (FECHA<="2018-12-31")),
x = ~FECHA,
y = ~total_registros,
type = "scatter" ,mode = "lines",
line=list(width=1,color='rgb(205, 12, 24)'))%>%
layout(title='Registros de accidentalidad',
xaxis=list(title="Día"),
yaxis=list(title="Total registros"))
acc_fecha$year<-format(acc_fecha$FECHA,"%Y")
plot_ly (data=subset(acc_fecha,subset = (FECHA<="2018-12-31")),
x = ~FECHA,
y = ~total_registros,
type = "scatter" ,mode = "lines",
split = ~year,
line=list(width=1))%>%
layout(title='Registros de accidentalidad',
xaxis=list(title="Día"),
yaxis=list(title="Total registros"))
aggregate(total_registros~year,data=acc_fecha,FUN=mean)
acc_fecha$Fecha<-as.Date(acc_fecha$FECHA,"%d/%m/%Y")
acc_fecha$mes<-format(acc_fecha$Fecha,"%m")
with(acc_fecha, month.abb[mes])
acc_fecha$mes<-strftime(acc_fecha$Fecha, format = "%B")
acc_fecha$mes<-ordered(acc_fecha$mes,levels=c( "enero", "febrero", "marzo",
"abril", "mayo", "junio","julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"))
aggregate(total_registros~mes,data=acc_fecha,FUN=mean)
aggregate(total_registros~year*mes,data=acc_fecha,FUN=mean)%>%
plot_ly(x = ~mes,
y = ~total_registros,
type = "scatter" ,mode = "lines",
split = ~year,
line=list(width=1))%>%
layout(title='Promedio diario mensual de accidentes registrados',
xaxis=list(title="Día"),
yaxis=list(title="Total registros"))
acc_fecha$diaano<-strftime(acc_fecha$Fecha, format = "%j")
plot_ly (data=subset(acc_fecha,subset = (Fecha<="2018-12-31")),
x = ~diaano,
y = ~total_registros,
type = "scatter" ,mode = "lines",
split = ~year,
line=list(width=1))%>%
layout(title='Registros de accidentes',
xaxis=list(title="Día"),
yaxis=list(title="Total registros"))
acc_fecha$diames<-format(acc_fecha$Fecha,"%d")
grafico<-function(month,data,sl=FALSE){
plot_ly (data=subset(data,subset = (Fecha<="2018-12-31" & mes==month)),
x = ~diames,
y = ~total_registros,
type = "scatter" ,mode = "lines",
split = ~year,
line=list(width=1),
legendgroup=~year,
showlegend = sl)%>%
layout(title='Registros de accidentes',
xaxis=list(title="Día"),
yaxis=list(title="Total registros"))->p
return(p)
}
meses<-unique(acc_fecha$mes)
gr1<-grafico(meses[1],data=acc_fecha,sl=FALSE)
gr2<-grafico(meses[2],data=acc_fecha,sl=FALSE)
gr3<-grafico(meses[3],data=acc_fecha,sl=FALSE)
gr4<-grafico(meses[4],data=acc_fecha,sl=FALSE)
gr5<-grafico(meses[5],data=acc_fecha,sl=FALSE)
gr6<-grafico(meses[6],data=acc_fecha,sl=FALSE)
gr7<-grafico(meses[7],acc_fecha,sl=FALSE)
gr8<-grafico(meses[8],acc_fecha,sl=FALSE)
gr9<-grafico(meses[9],acc_fecha,sl=FALSE)
gr10<-grafico(meses[10],acc_fecha,sl=FALSE)
gr11<-grafico(meses[11],acc_fecha,sl=FALSE)
gr12<-grafico(meses[12],acc_fecha,sl=TRUE)
subplot(gr1,gr2,gr3,gr4,gr5,gr6,gr7,gr8,gr9,gr10,gr11,gr12,nrows = 4,shareX = TRUE,
shareY = TRUE,which_layout=1)
library(lattice)
xyplot(total_registros~diames|mes,groups = year,data=acc_fecha,
subset = (Fecha<="2018-12-31"),type=c("l","g"),
auto.key = list(lines = TRUE, space = "bottom",columns=7,title="Año",cex=0.5),
layout=c(3,4))
plot_ly (data=subset(acc_fecha,subset = (Fecha<="2018-12-31")),
x = ~year,
y = ~total_registros,
type = "box")%>%
layout(title='Registros de accidentes',
xaxis=list(title="Año"),
yaxis=list(title="Total registros"))
acc_fecha$diames<-format(acc_fecha$Fecha,"%d")
acc_fecha$dia_semana<-weekdays(acc_fecha$Fecha)
acc_fecha$dia_semana<-ordered(acc_fecha$dia_semana,levels=c( "lunes", "martes", "miércoles", "jueves", "viernes", "sábado","domingo"))
plot_ly (data=subset(acc_fecha,subset = (Fecha<="2018-12-31")),
x = ~mes,
y = ~total_registros,
type = "box")%>%
layout(title='Registros de accidentes',
xaxis=list(title="Mes"),
yaxis=list(title="Total registros"))
plot_ly (data=subset(acc_fecha,subset = (Fecha<="2018-12-31")),
x = ~dia_semana,
y = ~total_registros,
type = "box")%>%
layout(title='Registros de accidentes',
xaxis=list(title="Mes"),
yaxis=list(title="Total registros"))
plot_ly (data = acc_comuna,
x = ~COMUNA,
y = ~total_registros,
type = "scatter",
mode = "lines",
line = list(width = 1, color = 'rgb(205, 12, 24)')) %>%
layout(title = 'Registros de la accidentalidad en Medellín',
xaxis = list(title="Comuna"),
yaxis = list(title="Registros"))
plot(acc$X, acc$Y, main="Scatterplot Ubicación")
modelo_lm<-lm(total_registros~dia_semana+mes,data=acc_fecha,subset = (Fecha<="2017-12-31"))
summary(modelo_lm)
y0_tr<-mean(acc_fecha$total_registros[acc_fecha$Fecha<="2017-12-31"])
r0_tr<-acc_fecha$total_registros[acc_fecha$Fecha<="2017-12-31"]-y0_tr
R0_tr<-mean(r0_tr^2)
y_pred_tr_lm<-predict(modelo_lm)
r_tr_lm<-acc_fecha$total_registros[acc_fecha$Fecha<="2017-12-31"]-y_pred_tr_lm
R_tr_lm<-mean(r_tr_lm^2)
R2_lm<-1-R_tr_lm/R0_tr
print(R2_lm)
modelo_glm<-glm(total_registros~dia_semana+mes,data=acc_fecha,subset = (Fecha<="2017-12-31"),family = "poisson")
summary(modelo_glm)
y_pred_tr_glm<-predict(modelo_glm,type="response")
r_tr_glm<-acc_fecha$total_registros[acc_fecha$Fecha<="2017-12-31"]-y_pred_tr_glm
R_tr_glm<-mean(r_tr_glm^2)
R2_tr_glm<-1-R_tr_glm/R0_tr
print(R2_tr_glm)
resultados_lm_glm<-data.frame(Fecha=  acc_fecha$Fecha[acc_fecha$Fecha<="2017-12-31"],     total_registros=acc_fecha$total_registros[acc_fecha$Fecha<="2017-12-31"],
pred_lm=y_pred_tr_lm,
pred_glm=y_pred_tr_glm,
res_lm=r_tr_lm,
res_glm=r_tr_glm)
plot_ly (data=resultados_lm_glm,
x = ~Fecha,
y = ~total_registros,
type = "scatter" ,mode = "lines",
name='Real',
line=list(width=1,color='rgb(60, 195, 64)'))%>%
add_trace(y= ~pred_lm,
name='Modelo lineal general',
line=list(width=1,color='rgb(22, 96, 167)'))%>%
add_trace(y= ~pred_glm,
name='Modelo Poisson',
line=list(width=1,color='rgb(255, 51, 0)'))%>%
layout(title='Registros de accidentes',
xaxis=list(title="Fecha"),
yaxis=list(title="Total registros"),
legend = list(x = 0.75, y = 0.9))
plot_ly (data=resultados_lm_glm,
x = ~total_registros,
y = ~pred_lm,
text = ~Fecha,
type = "scatter" ,mode="markers",
name='Modelo lineal general',
marker=list(size=3,color='rgb(22, 96, 167)'))%>%
add_trace(y= ~pred_glm,
text = ~Fecha,
name='Modelo lineal Poisson',
marker=list(size=3,color='rgb(255, 51, 0)'))%>%
add_trace(x=c(-500:3500),y=c(-500:3500),
mode="lines",text=rep(NA,4001),
name="Identidad")%>%
layout(title='Registros de accidentes',
xaxis=list(title="Observados"),
yaxis=list(title="Predichos"),
legend = list(x = 0.75, y = 0.9))
plot_ly (data=resultados_lm_glm,
x = ~total_registros,
y = ~res_lm,
type = "scatter" ,mode="markers",
name='Modelo lineal general',
text = ~Fecha,
marker=list(size=3,color='rgb(60, 195, 64)'))%>%
add_trace(y= ~res_glm,
name='Modelo Poisson',
text = ~Fecha,
marker=list(size=3,color='rgb(255, 51, 0)'))%>%
layout(title='Registros de accidentes',
xaxis=list(title="Observados"),
yaxis=list(title="Residuales"),
legend = list(x = 0.75, y = 0.9))
datos_val<-subset(acc_fecha,subset=(Fecha>="2018-01-01" & Fecha<="2018-12-31"))
y_pred_vl_lm<-predict(modelo_lm,newdata = datos_val)
y_pred_vl_glm<-predict(modelo_glm,type="response",newdata = datos_val)
r_vl_lm<-datos_val$total_registros-y_pred_vl_lm
r_vl_glm<-datos_val$total_registros-y_pred_vl_glm
r0_vl<-datos_val$total_registros-y0_tr
R_vl_lm<-mean(r_vl_lm^2)
R_vl_glm<-mean(r_vl_glm^2)
R0_vl<-mean(r0_vl^2)
R2_vl_lm<-1-R_vl_lm/R0_vl
R2_vl_glm<-1-R_vl_glm/R0_vl
print(R2_vl_lm)
print(R2_vl_glm)
resultados_lm_glm_val<-data.frame(Fecha=datos_val$Fecha,                            total_registros=datos_val$total_registros,
pred_lm=y_pred_vl_lm,
pred_glm=y_pred_vl_glm,
res_lm=r_vl_lm,
res_glm=r_vl_glm)
plot_ly (data=resultados_lm_glm_val,
x = ~Fecha,
y = ~total_registros,
type = "scatter" ,mode = "lines",
name='Real',
line=list(width=1,color='rgb(60, 195, 64)'))%>%
add_trace(y= ~pred_lm,
name='Modelo lineal general',
line=list(width=1,color='rgb(22, 96, 167)'))%>%
add_trace(y= ~pred_glm,
name='Modelo Poisson',
line=list(width=1,color='rgb(255, 51, 0)'))%>%
layout(title='Registros de accidentes(Validación)',
xaxis=list(title="Fecha"),
yaxis=list(title="Total registros"),
legend = list(x = 0.75, y = 0.9))
acc1 <- acc %>%
group_by(CLASE, FECHA) %>%
summarize(total_registros = n())
acc_c1 <- filter(acc1, CLASE == "ATROPELLO")
acc_c2 <- filter(acc1, CLASE == "CAIDA OCUPANTE")
acc_c3 <- filter(acc1, CLASE == "CHOQUE")
acc_c4 <- filter(acc1, CLASE == "INCENDIO")
acc_c5 <- filter(acc1, CLASE == "OTRO")
acc_c6 <- filter(acc1, CLASE == "VOLCAMIENTO")
acc_c1$year<-format(acc_c1$FECHA,"%Y")
acc_c2$year<-format(acc_c2$FECHA,"%Y")
acc_c3$year<-format(acc_c3$FECHA,"%Y")
acc_c4$year<-format(acc_c4$FECHA,"%Y")
acc_c5$year<-format(acc_c5$FECHA,"%Y")
acc_c6$year<-format(acc_c6$FECHA,"%Y")
aggregate(total_registros~year,data=acc_c1,FUN=mean)
aggregate(total_registros~year,data=acc_c2,FUN=mean)
aggregate(total_registros~year,data=acc_c3,FUN=mean)
aggregate(total_registros~year,data=acc_c4,FUN=mean)
aggregate(total_registros~year,data=acc_c5,FUN=mean)
aggregate(total_registros~year,data=acc_c6,FUN=mean)
acc_c1$Fecha<-as.Date(acc_c1$FECHA,"%d/%m/%Y")
acc_c2$Fecha<-as.Date(acc_c2$FECHA,"%d/%m/%Y")
acc_c3$Fecha<-as.Date(acc_c3$FECHA,"%d/%m/%Y")
acc_c4$Fecha<-as.Date(acc_c4$FECHA,"%d/%m/%Y")
acc_c5$Fecha<-as.Date(acc_c5$FECHA,"%d/%m/%Y")
acc_c6$Fecha<-as.Date(acc_c6$FECHA,"%d/%m/%Y")
acc_c1$mes<-format(acc_c1$Fecha,"%m")
acc_c2$mes<-format(acc_c2$Fecha,"%m")
acc_c3$mes<-format(acc_c3$Fecha,"%m")
acc_c4$mes<-format(acc_c4$Fecha,"%m")
acc_c5$mes<-format(acc_c5$Fecha,"%m")
acc_c6$mes<-format(acc_c6$Fecha,"%m")
with(acc_c1, month.abb[mes])
with(acc_c2, month.abb[mes])
with(acc_c3, month.abb[mes])
with(acc_c4, month.abb[mes])
with(acc_c5, month.abb[mes])
with(acc_c6, month.abb[mes])
acc_c1$mes<-strftime(acc_c1$Fecha, format = "%B")
acc_c2$mes<-strftime(acc_c2$Fecha, format = "%B")
acc_c3$mes<-strftime(acc_c3$Fecha, format = "%B")
acc_c4$mes<-strftime(acc_c4$Fecha, format = "%B")
acc_c5$mes<-strftime(acc_c5$Fecha, format = "%B")
acc_c6$mes<-strftime(acc_c6$Fecha, format = "%B")
acc_c1$mes<-ordered(acc_c1$mes,levels=c( "enero", "febrero", "marzo",
"abril", "mayo", "junio","julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"))
acc_c2$mes<-ordered(acc_c2$mes,levels=c( "enero", "febrero", "marzo",
"abril", "mayo", "junio","julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"))
acc_c3$mes<-ordered(acc_c3$mes,levels=c( "enero", "febrero", "marzo",
"abril", "mayo", "junio","julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"))
acc_c4$mes<-ordered(acc_c4$mes,levels=c( "enero", "febrero", "marzo",
"abril", "mayo", "junio","julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"))
acc_c5$mes<-ordered(acc_c5$mes,levels=c( "enero", "febrero", "marzo",
"abril", "mayo", "junio","julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"))
acc_c6$mes<-ordered(acc_c6$mes,levels=c( "enero", "febrero", "marzo",
"abril", "mayo", "junio","julio", "agosto", "septiembre", "octubre", "noviembre", "diciembre"))
aggregate(total_registros~year*mes,data=acc_c1,FUN=mean)
aggregate(total_registros~year*mes,data=acc_c2,FUN=mean)
aggregate(total_registros~year*mes,data=acc_c3,FUN=mean)
aggregate(total_registros~year*mes,data=acc_c4,FUN=mean)
aggregate(total_registros~year*mes,data=acc_c5,FUN=mean)
aggregate(total_registros~year*mes,data=acc_c6,FUN=mean)
acc_c1$diaano<-strftime(acc_c1$Fecha, format = "%j")
acc_c2$diaano<-strftime(acc_c2$Fecha, format = "%j")
acc_c3$diaano<-strftime(acc_c3$Fecha, format = "%j")
acc_c4$diaano<-strftime(acc_c4$Fecha, format = "%j")
acc_c5$diaano<-strftime(acc_c5$Fecha, format = "%j")
acc_c6$diaano<-strftime(acc_c6$Fecha, format = "%j")
acc_c1$diames<-format(acc_c1$Fecha,"%d")
acc_c2$diames<-format(acc_c2$Fecha,"%d")
acc_c3$diames<-format(acc_c3$Fecha,"%d")
acc_c4$diames<-format(acc_c4$Fecha,"%d")
acc_c5$diames<-format(acc_c5$Fecha,"%d")
acc_c6$diames<-format(acc_c6$Fecha,"%d")
acc_c1$dia_semana<-weekdays(acc_c1$Fecha)
acc_c2$dia_semana<-weekdays(acc_c2$Fecha)
acc_c3$dia_semana<-weekdays(acc_c3$Fecha)
acc_c4$dia_semana<-weekdays(acc_c4$Fecha)
acc_c5$dia_semana<-weekdays(acc_c5$Fecha)
acc_c6$dia_semana<-weekdays(acc_c6$Fecha)
acc_c1$dia_semana<-ordered(acc_c1$dia_semana,levels=c( "lunes", "martes", "miércoles", "jueves", "viernes", "sábado","domingo"))
acc_c2$dia_semana<-ordered(acc_c2$dia_semana,levels=c( "lunes", "martes", "miércoles", "jueves", "viernes", "sábado","domingo"))
acc_c3$dia_semana<-ordered(acc_c3$dia_semana,levels=c( "lunes", "martes", "miércoles", "jueves", "viernes", "sábado","domingo"))
acc_c4$dia_semana<-ordered(acc_c4$dia_semana,levels=c( "lunes", "martes", "miércoles", "jueves", "viernes", "sábado","domingo"))
acc_c5$dia_semana<-ordered(acc_c5$dia_semana,levels=c( "lunes", "martes", "miércoles", "jueves", "viernes", "sábado","domingo"))
acc_c6$dia_semana<-ordered(acc_c6$dia_semana,levels=c( "lunes", "martes", "miércoles", "jueves", "viernes", "sábado","domingo"))
plot_ly (data=subset(acc_c1,subset = (FECHA<="2018-12-31")),
x = ~FECHA,
y = ~total_registros,
type = "scatter" ,mode = "lines",
split = ~year,
line=list(width=1))%>%
layout(title='Registros de accidentalidad atropello',
xaxis=list(title="Día"),
yaxis=list(title="Total registros"))
plot_ly (data=subset(acc_c1,subset = (Fecha<="2018-12-31")),
x = ~year,
y = ~total_registros,
type = "box")%>%
layout(title='Registros de accidentes por Atropello',
xaxis=list(title="Año"),
yaxis=list(title="Total registros"))
plot_ly (data=subset(acc_c2,subset = (Fecha<="2018-12-31")),
x = ~year,
y = ~total_registros,
type = "box")%>%
layout(title='Registros de accidentes por caída ocupante',
xaxis=list(title="Año"),
yaxis=list(title="Total registros"))
plot_ly (data=subset(acc_c3,subset = (Fecha<="2018-12-31")),
x = ~year,
y = ~total_registros,
type = "box")%>%
layout(title='Registros de accidentes por choque',
xaxis=list(title="Año"),
yaxis=list(title="Total registros"))
plot_ly (data=subset(acc_c3,subset = (Fecha<="2018-12-31")),
x = ~dia_semana,
y = ~total_registros,
type = "box")%>%
layout(title='Registros de accidentes por choque',
xaxis=list(title="Año"),
yaxis=list(title="Total registros"))
modelo_lmc1<-lm(total_registros~dia_semana+mes,data=acc_c1,subset = (Fecha<="2017-12-31"))
summary(modelo_lmc1)
y0_trc1<-mean(acc_c1$total_registros[acc_c1$Fecha<="2017-12-31"])
r0_trc1<-acc_c1$total_registros[acc_c1$Fecha<="2017-12-31"]-y0_trc1
R0_trc1<-mean(r0_trc1^2)
y_pred_tr_lmc1<-predict(modelo_lmc1)
r_tr_lmc1<-acc_c1$total_registros[acc_c1$Fecha<="2017-12-31"]-y_pred_tr_lmc1
R_tr_lmc1<-mean(r_tr_lmc1^2)
R2_lmc1<-1-R_tr_lmc1/R0_trc1
print(R2_lmc1)
modelo_glmc1<-glm(total_registros~dia_semana+mes,data=acc_c1,subset = (Fecha<="2017-12-31"),family = "poisson")
summary(modelo_glmc1)
y_pred_tr_glmc1<-predict(modelo_glmc1,type="response")
r_tr_glmc1<-acc_c1$total_registros[acc_c1$Fecha<="2017-12-31"]-y_pred_tr_glmc1
R_tr_glmc1<-mean(r_tr_glmc1^2)
R2_tr_glmc1<-1-R_tr_glmc1/R0_trc1
print(R2_tr_glmc1)
resultados_lm_glmc1<-data.frame(Fecha=  acc_c1$Fecha[acc_c1$Fecha<="2017-12-31"],     total_registrosc1=acc_c1$total_registros[acc_c1$Fecha<="2017-12-31"],
pred_lmc1=y_pred_tr_lmc1,
pred_glmc1=y_pred_tr_glmc1,
res_lmc1=r_tr_lmc1,
res_glmc1=r_tr_glmc1)
plot_ly (data=resultados_lm_glmc1,
x = ~Fecha,
y = ~total_registrosc1,
type = "scatter" ,mode = "lines",
name='Real',
line=list(width=1,color='rgb(60, 195, 64)'))%>%
add_trace(y= ~pred_lmc1,
name='Modelo lineal general',
line=list(width=1,color='rgb(22, 96, 167)'))%>%
add_trace(y= ~pred_glmc1,
name='Modelo Poisson',
line=list(width=1,color='rgb(255, 51, 0)'))%>%
layout(title='Registros de accidentes',
xaxis=list(title="Fecha"),
yaxis=list(title="Total registros"),
legend = list(x = 0.75, y = 0.9))
plot_ly (data=resultados_lm_glmc1,
x = ~total_registrosc1,
y = ~pred_lmc1,
text = ~Fecha,
type = "scatter" ,mode="markers",
name='Modelo lineal general',
marker=list(size=3,color='rgb(22, 96, 167)'))%>%
add_trace(y= ~pred_glmc1,
text = ~Fecha,
name='Modelo lineal Poisson',
marker=list(size=3,color='rgb(255, 51, 0)'))%>%
add_trace(x=c(-500:3500),y=c(-500:3500),
mode="lines",text=rep(NA,4001),
name="Identidad")%>%
layout(title='Registros de accidentes',
xaxis=list(title="Observados"),
yaxis=list(title="Predichos"),
legend = list(x = 0.75, y = 0.9))
View(acc)
View(acc)
View(acc)
View(acc)
View(acc)
View(acc)
# cargar librerias
library(data.table)   # manejo de tablas
library(purrr)        # optimizacion de bucles
library(dplyr)        # manejo de tablas
library(plotly)       # graficos en html
library(tidyr)        # limpieza de datos
library(stringr)      # limpieza de texto
library(lubridate)    # limpieza de fechas
library(sf)           # manejo de archivos espaciales
# lista archivos
lista <- list.files(pattern = "^Acc.*.csv", include.dirs = T, recursive = T)
# leer todos los archivos
lista_df <- map(lista, fread, sep = ",", encoding = "UTF-8", colClasses = "c")
# agregar archivos del 2014 a 2018
acc <- bind_rows(lista_df)
# ver cabecera del archivo
head(acc)
# organizar fecha
acc$FECHA <- ymd(gsub(pattern = "T.*", replacement = "", acc$FECHA),
"%Y-%M-%D")[1:209426]
# eliminar datos nulos y corregir clase
acc <- acc[-which(acc$CLASE == ""),]
acc$CLASE <- iconv(acc$CLASE, from = "UTF-8", to = "ASCII//TRANSLIT")
acc$CLASE <- gsub("DE ", "", toupper(acc$CLASE))
# eliminar datos nulos y corregir disenio
acc <- acc[-which(acc$DISENO == ""),]
acc$DISENO <- iconv(acc$DISENO, from = "UTF-8", to = "ASCII//TRANSLIT")
acc$DISENO <- gsub("DE ", "", toupper(acc$DISENO))
# corregir tildes de DIA_NOMBRE
acc$DIA_NOMBRE <- iconv(acc$DIA_NOMBRE, from = "UTF-8", to = "ASCII//TRANSLIT")
# crear columna de comuna_barrio
acc <- mutate(acc, COMUNA_BARRIO = str_sub(CBML, 1, 4))
# cargar archivo shp de barrios de medellin
barrio <- read_sf("files/Limite_Barrio_Vereda_Catastral/Limite_Barrio_Vereda_Catastral.shp")
# unir columnas de nombre barrio y comuna
acc <- inner_join(acc,
select(barrio, CODIGO, NOMBRE_COM, NOMBRE_BAR),
by = c("COMUNA_BARRIO" = "CODIGO"))
# limpiar nombre de barrios
acc$NOMBRE_BAR <- iconv(acc$NOMBRE_BAR, from = "UTF-8", to = "ASCII//TRANSLIT")
acc$NOMBRE_BAR <- toupper(acc$NOMBRE_BAR)
# eliminar posibles duplicados por errores de union
acc <- data.table:::unique.data.table(acc, by = "RADICADO")
# eliminar columnas
acc <- select(acc, -BARRIO, -COMUNA, -OBJECTID, -RADICADO, -DIRECCION_ENC,
-DIRECCION, -HORA, -CBML, -TIPO_GEOCOD, -MES_NOMBRE, -geometry)
# renombrar
names(acc)[12:13] <- c("COMUNA","BARRIO")
festivos <- fread("files/festivos_y_especiales.csv", header = T)
festivos[,names(festivos)[-1]] <- festivos%>%transmute_at(c(names(festivos)[-1]),funs(ifelse(. == "X","Si", ifelse(. == "","No",.))))
festivos$FECHA <- ymd(festivos$FECHA)[1:172]
head(acc)
acc <- merge(x=acc,y=festivos, by ="FECHA", all.x = T)
acc[,names(festivos)[-1]]<-acc%>%transmute_at(c(names(festivos)[-1]),funs(ifelse(is.na(.),"No",.)))
head(acc)
View(acc)
View(acc)
acc_fecha1 <- acc %>%
group_by(FECHA,CLASE, GRAVEDAD, FESTIVO, MADRE, NAVIDAD, SEMSANTA, BRUJITOS,                       ESCOLAR) >%>
acc_fecha1 <- acc %>%
group_by(FECHA,CLASE, GRAVEDAD, FESTIVO, MADRE, NAVIDAD, SEMSANTA, BRUJITOS,ESCOLAR) >%>
acc_fecha1 <- acc %>%
group_by(FECHA,CLASE, GRAVEDAD, FESTIVO, MADRE, NAVIDAD, SEMSANTA, BRUJITOS,ESCOLAR)
head(acc_fecha1)
